å¦‚ä½•åœ¨åœ¨è„šæœ¬é‡Œé¢å¯åŠ¨pyæ–‡ä»¶ï¼Ÿ

å¦‚ä½•é€šè¿‡è„šæœ¬ä¼ å‚ï¼Ÿ

å¦‚ä½•å¯åŠ¨è„šæœ¬æ–‡ä»¶ï¼Ÿ

```shell
python data_multi30k.py --pair_dir $1 --dest_dir $1 --src_lang $2 --trg_lang $3

# æ–°å»ºtrain_læ–‡ä»¶ï¼Œåˆå¹¶ä¸¤ä¸ªæ–‡ä»¶åˆ°ä¸€ä¸ªæ–‡ä»¶
touch $1/train_l
cat $1/train_src.cut.txt >> $1/train_l
cat $1/train_trg.cut.txt >> $1/train_l

# ç”Ÿæˆè¯è¡¨ï¼Œsubwordæ–¹å¼,ç»Ÿä¸€ç”¨20000ä¸ªsubword
subword-nmt learn-joint-bpe-and-vocab \
    -i $1/train_l \
    -s 20000 \
    -o $1/bpe.20000 \
    --write-vocabulary $1/vocab

# åº”ç”¨åˆ†è¯
for mode in train val test; do
    subword-nmt apply-bpe -c $1/bpe.20000 < $1/${mode}_src.cut.txt > $1/${mode}_src.bpe
    subword-nmt apply-bpe -c $1/bpe.20000 < $1/${mode}_trg.cut.txt > $1/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done

```



ä½ æä¾›çš„è¿™æ®µè„šæœ¬æ˜¯ç”¨äºå¯¹ä¸€ä¸ªåŒè¯­æ•°æ®é›†ï¼ˆè‹±è¯­-å¾·è¯­ï¼‰è¿›è¡Œ **Subword åˆ†è¯å¤„ç†**ï¼ˆBPEï¼ŒByte Pair Encodingï¼‰ çš„å…¸å‹æµç¨‹ã€‚ä¸‹é¢æ˜¯è¿™æ®µä»£ç çš„é€æ­¥è§£æä¸ä¼˜åŒ–å»ºè®®ï¼š

------

### âœ… **è„šæœ¬ä½œç”¨è¯´æ˜**

è¯¥è„šæœ¬çš„æ•´ä½“ä»»åŠ¡æ˜¯ï¼š

1. **é¢„å¤„ç†åŸå§‹æ–‡æœ¬**ï¼ˆ`train_src.cut.txt` å’Œ `train_trg.cut.txt`ï¼‰ã€‚
2. **å­¦ä¹ è”åˆçš„BPEå­è¯è¯è¡¨**ï¼ˆ10000ä¸ªå­è¯å•ä½ï¼‰ã€‚
3. **åº”ç”¨BPEåˆ†è¯**äºè®­ç»ƒã€éªŒè¯ã€æµ‹è¯•é›†ã€‚

------

### ğŸ§¾ **è„šæœ¬é€è¡Œè§£é‡Š**

```
# è°ƒç”¨ Python è„šæœ¬å¤„ç†åŸå§‹å¯¹é½æ•°æ®ï¼Œå‡†å¤‡åŸå§‹è¾“å…¥æ–‡ä»¶
python data_multi30k.py --pair_dir $1 --dest_dir $1 --src_lang $2 --trg_lang $3
```

- `$1` æ˜¯æ•°æ®æ‰€åœ¨ç›®å½•ï¼Œä¾‹å¦‚ `data/`.
- `$2`, `$3` æ˜¯æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„ç¼©å†™ï¼Œå¦‚ `en`ã€`de`ã€‚

------

```
# åˆ›å»ºä¸´æ—¶è®­ç»ƒè¯­æ–™åˆå¹¶æ–‡ä»¶
touch $1/train_l
cat $1/train_src.cut.txt >> $1/train_l
cat $1/train_trg.cut.txt >> $1/train_l
```

- æŠŠæºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„åˆ‡è¯è®­ç»ƒé›†åˆå¹¶ï¼Œç”¨äºå­¦ä¹  **è”åˆBPEè¯è¡¨**ã€‚

------

```
# å­¦ä¹ è”åˆBPEè§„åˆ™ï¼Œå¾—åˆ°åˆ†è¯è§„åˆ™æ–‡ä»¶ bpe.10000 å’Œè¯æ±‡è¡¨ vocab
subword-nmt learn-joint-bpe-and-vocab \
    -i $1/train_l \
    -s 10000 \
    -o $1/bpe.10000 \
    --write-vocabulary $1/vocab
```

- ä½¿ç”¨ 10000 ä¸ª merge æ“ä½œï¼Œè®­ç»ƒå‡º BPE åˆ†è¯æ¨¡å‹ã€‚
- `bpe.10000` æ˜¯ BPE åˆå¹¶è§„åˆ™æ–‡ä»¶ã€‚
- `vocab` æ˜¯å¯¹åº”è¯æ±‡é¢‘ç‡ã€‚

------

```
# å¯¹ train/val/test å„æ¨¡å¼è¿›è¡Œ BPE åˆ†è¯
for mode in train val test; do
    subword-nmt apply-bpe -c $1/bpe.10000 < $1/${mode}_src.cut.txt > $1/${mode}_src.bpe
    subword-nmt apply-bpe -c $1/bpe.10000 < $1/${mode}_trg.cut.txt > $1/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done
```

- å¯¹æ¯ä¸ª modeï¼ˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•ï¼‰çš„æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€æ–‡ä»¶è¿›è¡Œ **BPEåˆ†è¯**ã€‚
- è¾“å‡ºä¸º `.bpe` æ–‡ä»¶ï¼Œå¯ä¾›åç»­å»ºæ¨¡ä½¿ç”¨ï¼ˆå¦‚ Transformerï¼‰ã€‚

------

### ğŸ’¡ **å‡ ç‚¹å»ºè®®**

1. **ç”¨ `>` è€Œä¸æ˜¯ `>>` åˆ›å»º `train_l` æ–‡ä»¶**ï¼ˆé˜²æ­¢å¤šæ¬¡è¿è¡Œé‡å¤è¿½åŠ ï¼‰ï¼š

   ```
   cat $1/train_src.cut.txt $1/train_trg.cut.txt > $1/train_l
   ```

2. **åŠ ä¸Š vocab é™åˆ¶å‚æ•°**ï¼ˆæé«˜å…¼å®¹æ€§ï¼‰ï¼š

   ```
   --vocabulary-threshold 50
   ```

3. **æ·»åŠ è¯­è¨€ç‰¹å®šè¯è¡¨**ï¼ˆæ¨èï¼‰ï¼š

   ```
   --write-vocabulary $1/vocab.src $1/vocab.trg
   ```

   ç„¶å apply æ—¶å¯ä»¥åŠ ä¸Š vocab é™åˆ¶ï¼ˆå¯é€‰ï¼‰ï¼š

   ```
   --vocabulary $1/vocab.src --vocabulary-threshold 50
   ```

------

### âœ… æœ€ç»ˆæ¨èè„šæœ¬ï¼ˆæ”¹è¿›ç‰ˆï¼‰

```
#!/bin/bash

PAIR_DIR=$1
SRC_LANG=$2
TRG_LANG=$3

# æ­¥éª¤ 1ï¼šé¢„å¤„ç†æ•°æ®
python data_multi30k.py --pair_dir $PAIR_DIR --dest_dir $PAIR_DIR --src_lang $SRC_LANG --trg_lang $TRG_LANG

# æ­¥éª¤ 2ï¼šåˆå¹¶è®­ç»ƒè¯­æ–™
cat $PAIR_DIR/train_src.cut.txt $PAIR_DIR/train_trg.cut.txt > $PAIR_DIR/train_l

# æ­¥éª¤ 3ï¼šè®­ç»ƒè”åˆBPE
subword-nmt learn-joint-bpe-and-vocab \
    -i $PAIR_DIR/train_l \
    -s 10000 \
    -o $PAIR_DIR/bpe.10000 \
    --write-vocabulary $PAIR_DIR/vocab.src $PAIR_DIR/vocab.trg

# æ­¥éª¤ 4ï¼šåº”ç”¨BPE
for mode in train val test; do
    subword-nmt apply-bpe -c $PAIR_DIR/bpe.10000 < $PAIR_DIR/${mode}_src.cut.txt > $PAIR_DIR/${mode}_src.bpe
    subword-nmt apply-bpe -c $PAIR_DIR/bpe.10000 < $PAIR_DIR/${mode}_trg.cut.txt > $PAIR_DIR/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done
```

------







