如何在在脚本里面启动py文件？

如何通过脚本传参？

如何启动脚本文件？

```shell
python data_multi30k.py --pair_dir $1 --dest_dir $1 --src_lang $2 --trg_lang $3

# 新建train_l文件，合并两个文件到一个文件
touch $1/train_l
cat $1/train_src.cut.txt >> $1/train_l
cat $1/train_trg.cut.txt >> $1/train_l

# 生成词表，subword方式,统一用20000个subword
subword-nmt learn-joint-bpe-and-vocab \
    -i $1/train_l \
    -s 20000 \
    -o $1/bpe.20000 \
    --write-vocabulary $1/vocab

# 应用分词
for mode in train val test; do
    subword-nmt apply-bpe -c $1/bpe.20000 < $1/${mode}_src.cut.txt > $1/${mode}_src.bpe
    subword-nmt apply-bpe -c $1/bpe.20000 < $1/${mode}_trg.cut.txt > $1/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done

```



你提供的这段脚本是用于对一个双语数据集（英语-德语）进行 **Subword 分词处理**（BPE，Byte Pair Encoding） 的典型流程。下面是这段代码的逐步解析与优化建议：

------

### ✅ **脚本作用说明**

该脚本的整体任务是：

1. **预处理原始文本**（`train_src.cut.txt` 和 `train_trg.cut.txt`）。
2. **学习联合的BPE子词词表**（10000个子词单位）。
3. **应用BPE分词**于训练、验证、测试集。

------

### 🧾 **脚本逐行解释**

```
# 调用 Python 脚本处理原始对齐数据，准备原始输入文件
python data_multi30k.py --pair_dir $1 --dest_dir $1 --src_lang $2 --trg_lang $3
```

- `$1` 是数据所在目录，例如 `data/`.
- `$2`, `$3` 是源语言和目标语言的缩写，如 `en`、`de`。

------

```
# 创建临时训练语料合并文件
touch $1/train_l
cat $1/train_src.cut.txt >> $1/train_l
cat $1/train_trg.cut.txt >> $1/train_l
```

- 把源语言和目标语言的切词训练集合并，用于学习 **联合BPE词表**。

------

```
# 学习联合BPE规则，得到分词规则文件 bpe.10000 和词汇表 vocab
subword-nmt learn-joint-bpe-and-vocab \
    -i $1/train_l \
    -s 10000 \
    -o $1/bpe.10000 \
    --write-vocabulary $1/vocab
```

- 使用 10000 个 merge 操作，训练出 BPE 分词模型。
- `bpe.10000` 是 BPE 合并规则文件。
- `vocab` 是对应词汇频率。

------

```
# 对 train/val/test 各模式进行 BPE 分词
for mode in train val test; do
    subword-nmt apply-bpe -c $1/bpe.10000 < $1/${mode}_src.cut.txt > $1/${mode}_src.bpe
    subword-nmt apply-bpe -c $1/bpe.10000 < $1/${mode}_trg.cut.txt > $1/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done
```

- 对每个 mode（训练/验证/测试）的源语言和目标语言文件进行 **BPE分词**。
- 输出为 `.bpe` 文件，可供后续建模使用（如 Transformer）。

------

### 💡 **几点建议**

1. **用 `>` 而不是 `>>` 创建 `train_l` 文件**（防止多次运行重复追加）：

   ```
   cat $1/train_src.cut.txt $1/train_trg.cut.txt > $1/train_l
   ```

2. **加上 vocab 限制参数**（提高兼容性）：

   ```
   --vocabulary-threshold 50
   ```

3. **添加语言特定词表**（推荐）：

   ```
   --write-vocabulary $1/vocab.src $1/vocab.trg
   ```

   然后 apply 时可以加上 vocab 限制（可选）：

   ```
   --vocabulary $1/vocab.src --vocabulary-threshold 50
   ```

------

### ✅ 最终推荐脚本（改进版）

```
#!/bin/bash

PAIR_DIR=$1
SRC_LANG=$2
TRG_LANG=$3

# 步骤 1：预处理数据
python data_multi30k.py --pair_dir $PAIR_DIR --dest_dir $PAIR_DIR --src_lang $SRC_LANG --trg_lang $TRG_LANG

# 步骤 2：合并训练语料
cat $PAIR_DIR/train_src.cut.txt $PAIR_DIR/train_trg.cut.txt > $PAIR_DIR/train_l

# 步骤 3：训练联合BPE
subword-nmt learn-joint-bpe-and-vocab \
    -i $PAIR_DIR/train_l \
    -s 10000 \
    -o $PAIR_DIR/bpe.10000 \
    --write-vocabulary $PAIR_DIR/vocab.src $PAIR_DIR/vocab.trg

# 步骤 4：应用BPE
for mode in train val test; do
    subword-nmt apply-bpe -c $PAIR_DIR/bpe.10000 < $PAIR_DIR/${mode}_src.cut.txt > $PAIR_DIR/${mode}_src.bpe
    subword-nmt apply-bpe -c $PAIR_DIR/bpe.10000 < $PAIR_DIR/${mode}_trg.cut.txt > $PAIR_DIR/${mode}_trg.bpe
    echo "Finished applying bpe to ${mode} files."
done
```

------







